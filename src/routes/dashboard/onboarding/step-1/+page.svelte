<script lang="ts">
	import * as Card from '$lib/components/ui/card/index.js';
	import { Badge } from '$lib/components/ui/badge';
	import Button from '$lib/components/ui/button/button.svelte';
	import { onMount } from 'svelte';
	import { step } from '../store';
	import { databases } from '$lib/sdk';
	import { Input } from '$lib/components/ui/input/index.js';
	import { Label } from '$lib/components/ui/label/index.js';
	import { goto } from '$app/navigation';
	import { ID } from 'appwrite';

	let selectedProvider: 'google' | 'apple' | 'outlook' | 'url' | null = null;
	let name = '';
	let url = '';
	let color = '';
	let form: HTMLFormElement;

	const colors = ['#FD366E', '#FE9567', '#7C67FE', '#85DBD8', '#68A3FE', '#FED367'];
	onMount(() => {
		step.set(1);
	});

	async function handleNext() {
		if (!form.checkValidity()) {
			form.requestSubmit();
		}
		if (selectedProvider === 'url') {
			try {
				await databases.createDocument('db', 'calendars', ID.unique(), { name, url, color });
				await goto('/dashboard/onboarding/step-1');
			} catch (error) {
				console.log(error);
			}
		}
	}

	$: if (!selectedProvider) {
		name = '';
		url = '';
		color = '';
	}
</script>

<div>
	<h1 class="mt-6 text-3xl font-bold">Connect a calendar to get started</h1>
	<p class="text-balance text-muted-foreground">
		Link your preferred calendar to seamlessly manage all your important events and reminders.
	</p>
	{#if !selectedProvider}
		<div class="mt-20 grid grid-cols-2 grid-rows-2 items-center justify-center gap-4">
			<Card.Root class="opacity-50">
				<Card.Header class="p-4">
					<div>
						<Badge variant="secondary">Soon</Badge>
					</div>
				</Card.Header>
				<Card.Content></Card.Content>
				<Card.Footer class="mt-auto flex flex-col items-start justify-start gap-2 p-4">
					<svg
						width="24"
						height="24"
						viewBox="0 0 24 24"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
					>
						<g id="Group 353">
							<path
								id="vector"
								d="M12.2446 4.63995C14.5438 4.63995 16.0948 5.61328 16.9792 6.42666L20.435 3.11999C18.3126 1.18667 15.5506 0 12.2446 0C7.45542 0 3.31937 2.6933 1.30579 6.61326L5.26495 9.62662C6.25823 6.7333 9.0065 4.63995 12.2446 4.63995Z"
								fill="#EB4335"
							/>
							<path
								id="vector_2"
								d="M5.27883 14.3733C5.02034 13.6267 4.87074 12.8266 4.87074 12C4.87074 11.1733 5.02034 10.3733 5.26523 9.62666L5.25839 9.46764L1.4313 6.55493L1.30608 6.6133C0.476193 8.23998 0 10.0667 0 12C0 13.9333 0.476193 15.7599 1.30608 17.3866L5.27883 14.3733Z"
								fill="#FBBC05"
							/>
							<path
								id="vector_3"
								d="M12.2445 24C15.5506 24 18.326 22.9333 20.3533 21.0933L16.4893 18.1599C15.4554 18.8666 14.0676 19.3599 12.2445 19.3599C9.00646 19.3599 6.2582 17.2666 5.27852 14.3733L5.13493 14.3852L1.35522 17.2519L1.30579 17.3866C3.31936 21.3066 7.45539 24 12.2445 24Z"
								fill="#34A853"
							/>
							<path
								id="vector_4"
								d="M24.0005 12.2663C24.0005 11.2796 23.9188 10.5596 23.742 9.81299H12.2455V14.2663H18.9937C18.8577 15.373 18.123 17.0396 16.4903 18.1596L16.4674 18.3086L20.1024 21.0683L20.3543 21.0929C22.6672 18.9996 24.0005 15.9196 24.0005 12.2663Z"
								fill="#4285F4"
							/>
						</g>
					</svg>

					<p>Google calendar</p>
				</Card.Footer>
			</Card.Root>
			<Card.Root class="opacity-50">
				<Card.Header class="p-4">
					<div>
						<Badge variant="secondary">Soon</Badge>
					</div>
				</Card.Header>
				<Card.Content></Card.Content>
				<Card.Footer class="mt-auto flex flex-col items-start justify-start gap-2 p-4">
					<svg
						width="28"
						height="26"
						viewBox="0 0 28 26"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
					>
						<g clip-path="url(#clip0_65_711)">
							<path
								d="M27.9001 13.6249C27.9015 13.4148 27.7924 13.2192 27.6125 13.1093H27.6093L27.598 13.1031L18.2422 7.59057C18.2018 7.5634 18.1599 7.53857 18.1166 7.5162C17.7554 7.3307 17.3263 7.3307 16.965 7.5162C16.9218 7.53859 16.8799 7.5634 16.8395 7.59057L7.48368 13.1031L7.47238 13.1093C7.18644 13.2863 7.09878 13.6605 7.27659 13.9452C7.32898 14.029 7.40115 14.0989 7.48682 14.1487L16.8426 19.6612C16.8832 19.6881 16.9251 19.713 16.9682 19.7356C17.3294 19.9211 17.7586 19.9211 18.1198 19.7356C18.1629 19.713 18.2048 19.6881 18.2454 19.6612L27.6012 14.1487C27.7881 14.0402 27.9022 13.8403 27.9001 13.6249Z"
								fill="#0A2767"
							/>
							<path
								d="M8.57427 9.94437H14.7139V15.5462H8.57427V9.94437ZM26.6442 4.25V1.68749C26.6589 1.04681 26.1494 0.515352 25.5058 0.5H9.57328C8.92962 0.515352 8.42014 1.04681 8.43488 1.68749V4.25L17.8535 6.74999L26.6442 4.25Z"
								fill="#0364B8"
							/>
							<path d="M8.43494 4.25H14.714V9.87499H8.43494V4.25Z" fill="#0078D4" />
							<path
								d="M20.9931 4.25H14.714V9.87499L20.9931 15.5H26.6442V9.87499L20.9931 4.25Z"
								fill="#28A8EA"
							/>
							<path d="M14.714 9.875H20.993V15.5H14.714V9.875Z" fill="#0078D4" />
							<path d="M14.714 15.5H20.993V21.125H14.714V15.5Z" fill="#0364B8" />
							<path d="M8.57434 15.5463H14.714V20.6388H8.57434V15.5463Z" fill="#14447D" />
							<path d="M20.993 15.5H26.6442V21.125H20.993V15.5Z" fill="#0078D4" />
							<path
								d="M27.6124 14.1144L27.6005 14.1206L18.2447 19.3581C18.2039 19.3831 18.1624 19.4069 18.1191 19.4281C17.9602 19.5034 17.7876 19.546 17.6117 19.5531L17.1006 19.2556C17.0574 19.234 17.0155 19.21 16.975 19.1837L7.49365 13.7975H7.48926L7.17908 13.625V24.2275C7.18391 24.9349 7.76377 25.5045 8.47444 25.5H26.6247C26.6354 25.5 26.6448 25.495 26.6561 25.495C26.8062 25.4854 26.9542 25.4547 27.0956 25.4037C27.1567 25.378 27.2157 25.3475 27.2721 25.3125C27.3141 25.2888 27.3863 25.2369 27.3863 25.2369C27.708 25 27.8984 24.6258 27.9 24.2275V13.625C27.8998 13.8278 27.7899 14.0148 27.6124 14.1144Z"
								fill="url(#paint0_linear_65_711)"
							/>
							<path
								opacity="0.5"
								d="M27.3976 13.5832V14.2332L17.6149 20.9375L7.48673 13.8019C7.48673 13.7985 7.48391 13.7957 7.48044 13.7957L6.55115 13.2394V12.7707L6.93417 12.7644L7.74416 13.2269L7.76299 13.2332L7.83206 13.2769C7.83206 13.2769 17.3511 18.6832 17.3762 18.6957L17.7404 18.9081C17.7718 18.8956 17.8032 18.8832 17.8409 18.8706C17.8597 18.8581 27.2909 13.5769 27.2909 13.5769L27.3976 13.5832Z"
								fill="#0A2767"
							/>
							<path
								d="M27.6124 14.1144L27.6005 14.1212L18.2447 19.3587C18.2038 19.3837 18.1624 19.4075 18.1191 19.4287C17.7557 19.6054 17.3308 19.6054 16.9675 19.4287C16.9245 19.4075 16.8826 19.3842 16.8419 19.3587L7.48612 14.1212L7.47482 14.1144C7.29419 14.0169 7.18095 13.8295 7.17908 13.625V24.2275C7.18357 24.9348 7.76323 25.5045 8.47376 25.5C8.47376 25.5 8.47379 25.5 8.47382 25.5H26.6052C27.3158 25.5045 27.8955 24.9348 27.9 24.2276C27.9 24.2276 27.9 24.2275 27.9 24.2275V13.625C27.8998 13.8278 27.7899 14.0148 27.6124 14.1144Z"
								fill="#1490DF"
							/>
							<path
								opacity="0.1"
								d="M18.381 19.2812L18.2409 19.3594C18.2004 19.3851 18.1584 19.4087 18.1154 19.43C17.9611 19.5054 17.7933 19.5496 17.6218 19.56L21.1814 23.75L27.3908 25.2394C27.5609 25.1114 27.6963 24.9432 27.7845 24.75L18.381 19.2812Z"
								fill="black"
							/>
							<path
								opacity="0.05"
								d="M19.0151 18.9263L18.2409 19.3594C18.2004 19.3851 18.1584 19.4087 18.1154 19.43C17.9611 19.5054 17.7933 19.5496 17.6218 19.56L19.2895 24.1369L27.3927 25.2375C27.7119 24.9989 27.8998 24.6248 27.9 24.2275V24.0906L19.0151 18.9263Z"
								fill="black"
							/>
							<path
								d="M8.4914 25.5H26.6034C26.8821 25.5014 27.1539 25.4138 27.3788 25.25L17.1 19.2569C17.0568 19.2353 17.0149 19.2113 16.9744 19.185L7.49302 13.7987H7.48863L7.17908 13.625V24.1912C7.17837 24.9134 7.76591 25.4993 8.4914 25.5Z"
								fill="#28A8EA"
							/>
							<path
								opacity="0.1"
								d="M15.9698 6.64562V19.9769C15.9687 20.4443 15.6831 20.8644 15.2477 21.0394C15.1128 21.0971 14.9675 21.1268 14.8207 21.1269H7.17908V6.12499H8.43489V5.5H14.8207C15.455 5.50239 15.9684 6.01421 15.9698 6.64562Z"
								fill="black"
							/>
							<path
								opacity="0.2"
								d="M15.3419 7.27067V20.6019C15.3434 20.7529 15.3113 20.9023 15.2477 21.0394C15.0733 21.4672 14.6566 21.7479 14.1928 21.75H7.17908V6.12505H14.1928C14.375 6.12323 14.5545 6.16847 14.714 6.25631C15.0989 6.44933 15.3417 6.84168 15.3419 7.27067Z"
								fill="black"
							/>
							<path
								opacity="0.2"
								d="M15.3419 7.27067V19.3519C15.3388 19.983 14.8268 20.4946 14.1928 20.5H7.17908V6.12505H14.1928C14.375 6.12323 14.5545 6.16847 14.714 6.25631C15.0989 6.44933 15.3417 6.84168 15.3419 7.27067Z"
								fill="black"
							/>
							<path
								opacity="0.2"
								d="M14.714 7.27062V19.3519C14.7133 19.984 14.1999 20.4969 13.5649 20.5H7.17908V6.125H13.5649C14.1998 6.12534 14.7143 6.63798 14.7139 7.27C14.714 7.27021 14.714 7.27041 14.714 7.27062Z"
								fill="black"
							/>
							<path
								d="M2.05097 6.125H13.563C14.1987 6.125 14.714 6.63792 14.714 7.27062V18.7294C14.714 19.3621 14.1987 19.875 13.563 19.875H2.05097C1.41532 19.875 0.900024 19.3621 0.900024 18.7294V7.27062C0.900024 6.63792 1.41533 6.125 2.05097 6.125Z"
								fill="url(#paint1_linear_65_711)"
							/>
							<path
								d="M4.49736 10.9299C4.78103 10.3284 5.2389 9.82491 5.8122 9.48432C6.44709 9.12251 7.16997 8.94214 7.90125 8.96306C8.57902 8.94843 9.24781 9.11944 9.83457 9.45743C10.3863 9.7849 10.8306 10.2647 11.1136 10.8387C11.4218 11.4711 11.5755 12.1671 11.5619 12.8699C11.5769 13.6044 11.4188 14.3322 11.1004 14.9949C10.8107 15.5894 10.3522 16.0863 9.78183 16.4243C9.17245 16.7726 8.47882 16.9481 7.7763 16.9318C7.08405 16.9484 6.40051 16.7755 5.80027 16.4318C5.24381 16.1039 4.79392 15.6235 4.50427 15.048C4.19421 14.4247 4.03876 13.7366 4.05093 13.0412C4.03801 12.3129 4.19063 11.5912 4.49736 10.9299ZM5.89884 14.3237C6.05009 14.704 6.30657 15.0338 6.63852 15.2749C6.97663 15.5101 7.38149 15.6315 7.79386 15.6212C8.23302 15.6385 8.6659 15.513 9.02707 15.2637C9.35482 15.0233 9.60456 14.6926 9.74539 14.3124C9.90283 13.8878 9.98052 13.4381 9.97458 12.9856C9.97944 12.5287 9.90641 12.0743 9.75857 11.6418C9.628 11.2513 9.38631 10.9069 9.06286 10.6506C8.71074 10.3895 8.27903 10.257 7.84032 10.2756C7.41902 10.2647 7.00509 10.387 6.65798 10.6249C6.32041 10.867 6.05907 11.1998 5.90449 11.5843C5.56159 12.4656 5.5598 13.4423 5.89946 14.3249L5.89884 14.3237Z"
								fill="white"
							/>
							<path d="M20.993 4.25H26.6442V9.87499H20.993V4.25Z" fill="#50D9FF" />
						</g>
						<defs>
							<linearGradient
								id="paint0_linear_65_711"
								x1="17.5395"
								y1="13.625"
								x2="17.5395"
								y2="25.5"
								gradientUnits="userSpaceOnUse"
							>
								<stop stop-color="#35B8F1" />
								<stop offset="1" stop-color="#28A8EA" />
							</linearGradient>
							<linearGradient
								id="paint1_linear_65_711"
								x1="3.29979"
								y1="5.22983"
								x2="12.2516"
								y2="20.8061"
								gradientUnits="userSpaceOnUse"
							>
								<stop stop-color="#1784D9" />
								<stop offset="0.5" stop-color="#107AD5" />
								<stop offset="1" stop-color="#0A63C9" />
							</linearGradient>
							<clipPath id="clip0_65_711">
								<rect width="27" height="25" fill="white" transform="translate(0.900024 0.5)" />
							</clipPath>
						</defs>
					</svg>

					<p>Outlook</p>
				</Card.Footer>
			</Card.Root>

			<Card.Root class="opacity-50">
				<Card.Header class="p-4">
					<div>
						<Badge variant="secondary">Soon</Badge>
					</div>
				</Card.Header>
				<Card.Content></Card.Content>
				<Card.Footer class="mt-auto flex flex-col items-start justify-start gap-2 p-4">
					<svg
						width="24"
						height="24"
						viewBox="0 0 32 32"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path
							d="M26.1916 23.4481C25.7847 24.3797 25.3029 25.2373 24.7448 26.0258C23.9841 27.1006 23.3612 27.8446 22.8811 28.2578C22.137 28.936 21.3397 29.2833 20.4859 29.303C19.873 29.303 19.1338 29.1302 18.2734 28.7796C17.4101 28.4306 16.6168 28.2578 15.8914 28.2578C15.1307 28.2578 14.3148 28.4306 13.4421 28.7796C12.568 29.1302 11.8639 29.3129 11.3256 29.331C10.5068 29.3656 9.69075 29.0084 8.87617 28.2578C8.35627 27.8084 7.70597 27.0381 6.92693 25.9467C6.09109 24.7813 5.40392 23.4299 4.86557 21.8893C4.28902 20.2251 4 18.6136 4 17.0535C4 15.2664 4.38968 13.7251 5.17021 12.4334C5.78363 11.3959 6.59971 10.5775 7.62109 9.9767C8.64246 9.37589 9.74607 9.06973 10.9345 9.05014C11.5848 9.05014 12.4376 9.24948 13.4974 9.64123C14.5541 10.0343 15.2327 10.2336 15.5302 10.2336C15.7526 10.2336 16.5064 10.0006 17.7842 9.53589C18.9926 9.10495 20.0125 8.92652 20.848 8.99681C23.112 9.17787 24.8129 10.0623 25.9441 11.6557C23.9193 12.8714 22.9177 14.5743 22.9376 16.7587C22.9559 18.4602 23.5788 19.8761 24.803 21.0004C25.3578 21.5222 25.9773 21.9255 26.6667 22.2119C26.5172 22.6415 26.3594 23.053 26.1916 23.4481ZM20.9992 3.20011C20.9992 4.53375 20.5075 5.77896 19.5275 6.93152C18.3448 8.30168 16.9143 9.09343 15.3631 8.9685C15.3433 8.8085 15.3318 8.64011 15.3318 8.46316C15.3318 7.18287 15.8943 5.81271 16.8931 4.69241C17.3917 4.12519 18.0259 3.65355 18.795 3.27731C19.5624 2.90669 20.2882 2.70172 20.9709 2.66663C20.9909 2.84491 20.9992 3.02321 20.9992 3.20009V3.20011Z"
							fill="white"
						/>
					</svg>

					<p>Apple calendar</p>
				</Card.Footer>
			</Card.Root>
			<button on:click={() => (selectedProvider = 'url')}>
				<Card.Root>
					<Card.Header class="p-7"></Card.Header>
					<Card.Content></Card.Content>
					<Card.Footer class="mt-auto flex flex-col items-start justify-start gap-2 p-4">
						<svg
							width="24"
							height="24"
							viewBox="0 0 24 24"
							fill="none"
							xmlns="http://www.w3.org/2000/svg"
						>
							<path
								d="M15.1033 5.50297C16.0406 4.56571 17.5602 4.56571 18.4974 5.50297C19.4347 6.44023 19.4347 7.95982 18.4974 8.89708L14.8974 12.4971C13.9602 13.4343 12.4406 13.4343 11.5033 12.4971C11.0347 12.0285 10.2749 12.0285 9.80626 12.4971C9.33763 12.9657 9.33763 13.7255 9.80626 14.1941C11.6808 16.0687 14.72 16.0687 16.5945 14.1941L20.1945 10.5941C22.069 8.71962 22.069 5.68043 20.1945 3.80591C18.32 1.9314 15.2808 1.9314 13.4063 3.80591L11.6063 5.60591C11.1376 6.07454 11.1376 6.83434 11.6063 7.30297C12.0749 7.7716 12.8347 7.7716 13.3033 7.30297L15.1033 5.50297Z"
								fill="white"
							/>
							<path
								d="M9.10333 11.503C10.0406 10.5657 11.5602 10.5657 12.4974 11.503C12.9661 11.9716 13.7259 11.9716 14.1945 11.503C14.6631 11.0343 14.6631 10.2745 14.1945 9.80591C12.32 7.9314 9.28079 7.9314 7.40628 9.80591L3.80628 13.4059C1.93176 15.2804 1.93176 18.3196 3.80628 20.1941C5.68079 22.0687 8.71999 22.0687 10.5945 20.1941L12.3945 18.3941C12.8631 17.9255 12.8631 17.1657 12.3945 16.6971C11.9259 16.2285 11.1661 16.2285 10.6974 16.6971L8.89745 18.4971C7.96019 19.4343 6.44059 19.4343 5.50333 18.4971C4.56608 17.5598 4.56608 16.0402 5.50333 15.103L9.10333 11.503Z"
								fill="white"
							/>
						</svg>

						<p>Calendar URL</p>
					</Card.Footer>
				</Card.Root>
			</button>
		</div>
	{:else if selectedProvider === 'url'}
		<form class="mt-20 grid gap-10" on:submit|preventDefault bind:this={form}>
			<div class="grid gap-2">
				<Label for="url">Calendar URL</Label>
				<Input id="url" type="url" placeholder="Enter URL" required bind:value={url} />
			</div>
			<div class="grid gap-2">
				<Label for="url">Calendar name</Label>
				<Input id="name" type="text" required placeholder="Enter name" bind:value={name} />
			</div>
			<div class="grid gap-2">
				<Label for="url">Calendar color</Label>
				<div class="flex gap-2">
					{#each colors as c}
						<button
							type="button"
							class={`border-separate rounded-full border text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:border-primary `}
							disabled={color === c}
							on:click={() => (color = c)}
						>
							<div class="m-1 h-10 w-10 rounded-full" style={`background-color: ${c}`}></div>
						</button>
					{/each}
				</div>
			</div>
		</form>
	{/if}
</div>

<div class="mt-auto flex justify-between">
	{#if selectedProvider}
		<Button variant="outline" on:click={() => (selectedProvider = null)}>Back</Button>
		<Button on:click={handleNext}>Next</Button>
	{/if}
</div>
